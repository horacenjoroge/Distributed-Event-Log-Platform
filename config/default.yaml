# DistributedLog Configuration
# Protocol version for backward/forward compatibility
protocol:
  version: 1
  min_supported_version: 1
  max_supported_version: 1

broker:
  id: 0  # Unique broker ID (override per instance)
  host: "0.0.0.0"
  port: 9092
  grpc_port: 9093
  data_dir: "/var/lib/distributedlog/data"
  
  # Log segment settings
  log:
    segment_size_bytes: 1073741824  # 1GB
    index_interval_bytes: 4096
    flush_interval_ms: 1000
    retention_hours: 168  # 7 days
    retention_bytes: -1   # Unlimited
    compaction_enabled: false
    
  # Replication settings
  replication:
    default_replication_factor: 3
    min_insync_replicas: 2
    replica_fetch_max_bytes: 1048576  # 1MB
    replica_lag_time_max_ms: 10000
    
  # Network settings
  network:
    num_io_threads: 8
    num_network_threads: 3
    socket_send_buffer_bytes: 102400
    socket_receive_buffer_bytes: 102400
    max_request_size: 104857600  # 100MB
    connection_timeout_ms: 5000
    request_timeout_ms: 30000

# Consensus (Raft) settings
consensus:
  election_timeout_min_ms: 150
  election_timeout_max_ms: 300
  heartbeat_interval_ms: 50
  snapshot_threshold: 10000

# Coordination settings (for cluster metadata)
coordination:
  type: "etcd"  # etcd or zookeeper
  endpoints:
    - "localhost:2379"
  session_timeout_ms: 10000
  connection_timeout_ms: 5000

# Producer settings
producer:
  acks: "all"  # 0, 1, or "all"
  batch_size: 16384
  linger_ms: 5
  buffer_memory: 33554432  # 32MB
  max_block_ms: 60000
  retries: 3
  retry_backoff_ms: 100
  compression_type: "none"  # none, gzip, snappy, lz4, zstd
  idempotence: true  # For exactly-once semantics

# Consumer settings
consumer:
  group_id: null
  auto_offset_reset: "latest"  # earliest, latest, none
  enable_auto_commit: true
  auto_commit_interval_ms: 5000
  fetch_min_bytes: 1
  fetch_max_bytes: 52428800  # 50MB
  max_poll_records: 500
  session_timeout_ms: 45000
  heartbeat_interval_ms: 3000

# Metrics settings
metrics:
  enabled: true
  port: 9094
  path: "/metrics"
  
# Logging settings
logging:
  level: "INFO"
  format: "json"  # json or console
  output: "stdout"  # stdout, stderr, or file path
